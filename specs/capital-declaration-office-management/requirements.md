# Requirements: Capital Declaration Office Management

## Overview

מערכת ניהול מלאה להצהרות הון מצד המשרד, כולל מעקב סטטוסים, תיעוד תקשורת, ניהול קנסות, ודשבורד משופר.

## Background

המערכת הקיימת תומכת ביצירת הצהרות הון ופורטל לקוח להעלאת מסמכים, אך חסרים פיצ'רים קריטיים לניהול יומיומי:
- אין אפשרות לשנות סטטוס ידנית
- אין תיעוד של תקשורת עם לקוחות
- אין ניהול קנסות למרות שהשדות קיימים ב-DB
- דשבורד פשוט ללא סטטיסטיקות ופילטרים

## Goals

1. **ניהול סטטוסים מלא** - שינוי ידני + היסטוריה + מעברים אוטומטיים
2. **תיעוד תקשורת** - לוג שיחות, הודעות WhatsApp, הערות
3. **ניהול קנסות** - מעקב אחר קנסות, ערעורים ותשלומים
4. **דשבורד משופר** - סטטיסטיקות, פילטרים מתקדמים, טבלה מורחבת
5. **הקצאת רו"ח** - יכולת להקצות רו"ח אחראי להצהרה
6. **תזכורות אימייל** - שליחת תזכורות ללקוחות

## Acceptance Criteria

### Status Management
- [ ] רו"ח יכול לשנות סטטוס הצהרה דרך דיאלוג עם הערות
- [ ] כל שינוי סטטוס נרשם בטבלת `declarationStatusHistory`
- [ ] ציר זמן מציג את כל שינויי הסטטוס עם תאריכים ומי ביצע
- [ ] כניסה ראשונה לפורטל משנה סטטוס ל-`in_progress` אוטומטית
- [ ] לחיצה על "סיימתי להעלות" משנה סטטוס ל-`documents_received`

### Communication Logging
- [ ] רו"ח יכול לתעד שיחה/הודעה/הערה דרך דיאלוג
- [ ] כרטיס מציג היסטוריית תקשורת כרונולוגית
- [ ] כפתור WhatsApp שולח הודעה מוכנה ומתעד אוטומטית
- [ ] תמיכה בסוגי תקשורת: שיחה, WhatsApp, הערה, מכתב
- [ ] תמיכה בכיוון: נכנסת/יוצאת

### Penalty Management
- [ ] כרטיס ניהול קנס מוצג רק אחרי הגשה באיחור
- [ ] תמיכה בסטטוסי קנס: התקבל, ערעור הוגש, בוטל, שולם
- [ ] שדות לתיעוד ערעור (תאריך + הערות)
- [ ] שדות לתיעוד תשלום (תאריך + סכום + מי שילם)
- [ ] Badge צבעוני לסטטוס קנס בטבלה
- [ ] אינדיקטור ויזואלי להגשה באיחור

### Dashboard Improvements
- [ ] 7 כרטיסי סטטיסטיקה (סה"כ, קריטי, דחוף, ממתין, נשלח, בתהליך, הוגש)
- [ ] פילטר חיפוש טקסט (שם/אימייל)
- [ ] פילטר סטטוס
- [ ] פילטר שנת מס
- [ ] פילטר עדיפות (למנהלים)
- [ ] פילטר רו"ח מוקצה (למנהלים)
- [ ] 12 עמודות בטבלה כולל דדליינים עם ימים שנותרו
- [ ] לחיצה על שורה מנווטת לדף פרטים

### Accountant Assignment
- [ ] Dropdown לבחירת רו"ח אחראי
- [ ] זמין רק למנהלים
- [ ] עדכון מיידי

### Email Reminders
- [ ] דיאלוג לשליחת תזכורת באימייל
- [ ] תבניות מוכנות (בקשת מסמכים, עדכון סטטוס)
- [ ] תיעוד אוטומטי בהיסטוריית תקשורת

## Dependencies

- טבלת `declarationStatusHistory` קיימת אך לא בשימוש
- טבלת `declarationCommunication` קיימת אך לא בשימוש
- שדות קנס קיימים בטבלת `declaration`
- קומפוננטות shadcn קיימות (Dialog, Select, Badge, Card)
- date-fns עם locale עברית

## Out of Scope

- שינויים בפורטל הלקוח (מלבד כפתור "סיימתי להעלות")
- יצירת PDF אוטומטי
- אינטגרציה עם רשות המסים
- התראות push
